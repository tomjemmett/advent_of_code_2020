<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Day 11 Seating System | Advent of Code 2020</title>
  <meta name="description" content="My attempt to complete AOC 2020 in R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Day 11 Seating System | Advent of Code 2020" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="My attempt to complete AOC 2020 in R" />
  <meta name="github-repo" content="tomjemmett/advent-of-code-2020" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Day 11 Seating System | Advent of Code 2020" />
  
  <meta name="twitter:description" content="My attempt to complete AOC 2020 in R" />
  

<meta name="author" content="Tom Jemmett" />


<meta name="date" content="2020-12-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="adapter-array.html"/>
<link rel="next" href="rain-risk.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Advent of Code 2020</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="report-repair.html"><a href="report-repair.html"><i class="fa fa-check"></i><b>1</b> Report Repair</a><ul>
<li class="chapter" data-level="1.1" data-path="report-repair.html"><a href="report-repair.html#part-1"><i class="fa fa-check"></i><b>1.1</b> Part 1</a><ul>
<li class="chapter" data-level="1.1.1" data-path="report-repair.html"><a href="report-repair.html#is-the-improved-algorithm-any-better"><i class="fa fa-check"></i><b>1.1.1</b> is the improved algorithm any better?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="report-repair.html"><a href="report-repair.html#part-2"><i class="fa fa-check"></i><b>1.2</b> Part 2</a><ul>
<li class="chapter" data-level="1.2.1" data-path="report-repair.html"><a href="report-repair.html#is-our-improved-algorithm-better-this-time"><i class="fa fa-check"></i><b>1.2.1</b> Is our improved algorithm better this time?</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="report-repair.html"><a href="report-repair.html#extra-implementing-in-python"><i class="fa fa-check"></i><b>1.3</b> Extra: Implementing in Python</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="password-philosophy.html"><a href="password-philosophy.html"><i class="fa fa-check"></i><b>2</b> Password Philosophy</a><ul>
<li class="chapter" data-level="2.1" data-path="password-philosophy.html"><a href="password-philosophy.html#part-1-1"><i class="fa fa-check"></i><b>2.1</b> Part 1</a></li>
<li class="chapter" data-level="2.2" data-path="password-philosophy.html"><a href="password-philosophy.html#part-2-1"><i class="fa fa-check"></i><b>2.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="toboggan-trajectory.html"><a href="toboggan-trajectory.html"><i class="fa fa-check"></i><b>3</b> Toboggan Trajectory</a><ul>
<li class="chapter" data-level="3.1" data-path="toboggan-trajectory.html"><a href="toboggan-trajectory.html#part-1-2"><i class="fa fa-check"></i><b>3.1</b> Part 1</a></li>
<li class="chapter" data-level="3.2" data-path="toboggan-trajectory.html"><a href="toboggan-trajectory.html#part-2-2"><i class="fa fa-check"></i><b>3.2</b> Part 2</a></li>
<li class="chapter" data-level="3.3" data-path="toboggan-trajectory.html"><a href="toboggan-trajectory.html#extra-is-there-a-path-that-minimises-the-number-of-trees-you-encounter"><i class="fa fa-check"></i><b>3.3</b> Extra: Is there a path that minimises the number of trees you encounter?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="passport-processing.html"><a href="passport-processing.html"><i class="fa fa-check"></i><b>4</b> Passport Processing</a><ul>
<li class="chapter" data-level="4.1" data-path="passport-processing.html"><a href="passport-processing.html#part-1-3"><i class="fa fa-check"></i><b>4.1</b> Part 1</a></li>
<li class="chapter" data-level="4.2" data-path="passport-processing.html"><a href="passport-processing.html#part-2-3"><i class="fa fa-check"></i><b>4.2</b> Part 2</a></li>
<li class="chapter" data-level="4.3" data-path="passport-processing.html"><a href="passport-processing.html#extra-solving-with-regular-expressions"><i class="fa fa-check"></i><b>4.3</b> Extra: Solving with regular expressions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="binary-boarding.html"><a href="binary-boarding.html"><i class="fa fa-check"></i><b>5</b> Binary Boarding</a><ul>
<li class="chapter" data-level="5.1" data-path="binary-boarding.html"><a href="binary-boarding.html#part-1-4"><i class="fa fa-check"></i><b>5.1</b> Part 1</a></li>
<li class="chapter" data-level="5.2" data-path="binary-boarding.html"><a href="binary-boarding.html#part-2-4"><i class="fa fa-check"></i><b>5.2</b> Part 2</a></li>
<li class="chapter" data-level="5.3" data-path="binary-boarding.html"><a href="binary-boarding.html#extra-solving-algebraicly"><i class="fa fa-check"></i><b>5.3</b> Extra: Solving algebraicly</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="custom-customs.html"><a href="custom-customs.html"><i class="fa fa-check"></i><b>6</b> Custom Customs</a><ul>
<li class="chapter" data-level="6.1" data-path="custom-customs.html"><a href="custom-customs.html#part-1-5"><i class="fa fa-check"></i><b>6.1</b> Part 1</a></li>
<li class="chapter" data-level="6.2" data-path="custom-customs.html"><a href="custom-customs.html#part-2-5"><i class="fa fa-check"></i><b>6.2</b> Part 2</a></li>
<li class="chapter" data-level="6.3" data-path="custom-customs.html"><a href="custom-customs.html#extra-solving-part-1-2-with-set-functions"><i class="fa fa-check"></i><b>6.3</b> Extra: solving part 1 &amp; 2 with set functions</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="handy-haversacks.html"><a href="handy-haversacks.html"><i class="fa fa-check"></i><b>7</b> Handy Haversacks</a><ul>
<li class="chapter" data-level="7.1" data-path="handy-haversacks.html"><a href="handy-haversacks.html#part-1-6"><i class="fa fa-check"></i><b>7.1</b> Part 1</a></li>
<li class="chapter" data-level="7.2" data-path="handy-haversacks.html"><a href="handy-haversacks.html#part-2-6"><i class="fa fa-check"></i><b>7.2</b> Part 2</a></li>
<li class="chapter" data-level="7.3" data-path="handy-haversacks.html"><a href="handy-haversacks.html#extra-alternative-solution-to-part-2"><i class="fa fa-check"></i><b>7.3</b> Extra: alternative solution to part 2</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="handheld-halting.html"><a href="handheld-halting.html"><i class="fa fa-check"></i><b>8</b> Handheld Halting</a><ul>
<li class="chapter" data-level="8.1" data-path="handheld-halting.html"><a href="handheld-halting.html#part-1-7"><i class="fa fa-check"></i><b>8.1</b> Part 1</a></li>
<li class="chapter" data-level="8.2" data-path="handheld-halting.html"><a href="handheld-halting.html#part-2-7"><i class="fa fa-check"></i><b>8.2</b> Part 2</a></li>
<li class="chapter" data-level="8.3" data-path="handheld-halting.html"><a href="handheld-halting.html#extra-update-the-computer-class"><i class="fa fa-check"></i><b>8.3</b> Extra: update the computer class</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="encoding-error.html"><a href="encoding-error.html"><i class="fa fa-check"></i><b>9</b> Encoding Error</a><ul>
<li class="chapter" data-level="9.1" data-path="encoding-error.html"><a href="encoding-error.html#part-1-8"><i class="fa fa-check"></i><b>9.1</b> Part 1</a></li>
<li class="chapter" data-level="9.2" data-path="encoding-error.html"><a href="encoding-error.html#part-2-8"><i class="fa fa-check"></i><b>9.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="adapter-array.html"><a href="adapter-array.html"><i class="fa fa-check"></i><b>10</b> Adapter Array</a><ul>
<li class="chapter" data-level="10.1" data-path="adapter-array.html"><a href="adapter-array.html#part-1-9"><i class="fa fa-check"></i><b>10.1</b> Part 1</a></li>
<li class="chapter" data-level="10.2" data-path="adapter-array.html"><a href="adapter-array.html#part-2-9"><i class="fa fa-check"></i><b>10.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="seating-system.html"><a href="seating-system.html"><i class="fa fa-check"></i><b>11</b> Seating System</a><ul>
<li class="chapter" data-level="11.1" data-path="seating-system.html"><a href="seating-system.html#part-1-10"><i class="fa fa-check"></i><b>11.1</b> Part 1</a></li>
<li class="chapter" data-level="11.2" data-path="seating-system.html"><a href="seating-system.html#part-2-10"><i class="fa fa-check"></i><b>11.2</b> Part 2</a></li>
<li class="chapter" data-level="11.3" data-path="seating-system.html"><a href="seating-system.html#solving-faster"><i class="fa fa-check"></i><b>11.3</b> Solving faster</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="rain-risk.html"><a href="rain-risk.html"><i class="fa fa-check"></i><b>12</b> Rain Risk</a><ul>
<li class="chapter" data-level="12.1" data-path="rain-risk.html"><a href="rain-risk.html#part-1-11"><i class="fa fa-check"></i><b>12.1</b> Part 1</a></li>
<li class="chapter" data-level="12.2" data-path="rain-risk.html"><a href="rain-risk.html#part-2-11"><i class="fa fa-check"></i><b>12.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="shuttle-search.html"><a href="shuttle-search.html"><i class="fa fa-check"></i><b>13</b> Shuttle Search</a><ul>
<li class="chapter" data-level="13.1" data-path="shuttle-search.html"><a href="shuttle-search.html#part-1-12"><i class="fa fa-check"></i><b>13.1</b> Part 1</a></li>
<li class="chapter" data-level="13.2" data-path="shuttle-search.html"><a href="shuttle-search.html#part-2-12"><i class="fa fa-check"></i><b>13.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="docking-data.html"><a href="docking-data.html"><i class="fa fa-check"></i><b>14</b> Docking Data</a><ul>
<li class="chapter" data-level="14.1" data-path="docking-data.html"><a href="docking-data.html#part-1-13"><i class="fa fa-check"></i><b>14.1</b> Part 1</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="part-2-13.html"><a href="part-2-13.html"><i class="fa fa-check"></i><b>15</b> Part 2</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advent of Code 2020</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="seating-system" class="section level1">
<h1><span class="header-section-number">Day 11</span> Seating System</h1>
<p>This is my attempt to solve <a href="https://adventofcode.com/2020/day/11">Day 11</a>.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="seating-system.html#cb174-1"></a>sample &lt;-<span class="st"> </span><span class="kw">read_lines</span>(<span class="st">&quot;samples/day_11_sample.txt&quot;</span>)</span>
<span id="cb174-2"><a href="seating-system.html#cb174-2"></a>actual &lt;-<span class="st"> </span><span class="kw">read_lines</span>(<span class="st">&quot;inputs/day_11_input.txt&quot;</span>)</span></code></pre></div>
<div id="part-1-10" class="section level2">
<h2><span class="header-section-number">11.1</span> Part 1</h2>
<p>We are given that in our input:</p>
<ul>
<li><code>.</code> is the floor</li>
<li><code>L</code> is an empty seat</li>
<li><code>#</code> is an occupied seat</li>
</ul>
<p>It will make our life simpler to add a border of empty seats round our inputs, and convert the input to a matrix of
individual characters</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="seating-system.html#cb175-1"></a>process_input &lt;-<span class="st"> </span><span class="cf">function</span>(input) {</span>
<span id="cb175-2"><a href="seating-system.html#cb175-2"></a>  dl &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">rep</span>(<span class="st">&quot;.&quot;</span>, <span class="kw">str_length</span>(input[[<span class="dv">1</span>]])), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb175-3"><a href="seating-system.html#cb175-3"></a>  m &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;.&quot;</span>, <span class="kw">c</span>(dl, input, dl), <span class="st">&quot;.&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb175-4"><a href="seating-system.html#cb175-4"></a><span class="st">    </span><span class="kw">str_extract_all</span>(<span class="st">&quot;.&quot;</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)</span>
<span id="cb175-5"><a href="seating-system.html#cb175-5"></a>  </span>
<span id="cb175-6"><a href="seating-system.html#cb175-6"></a>  <span class="co"># give this matrix an s3 class of &quot;day11&quot;</span></span>
<span id="cb175-7"><a href="seating-system.html#cb175-7"></a>  <span class="kw">structure</span>(m, <span class="dt">class =</span> <span class="kw">c</span>(<span class="st">&quot;day11&quot;</span>, <span class="kw">class</span>(m)))</span>
<span id="cb175-8"><a href="seating-system.html#cb175-8"></a>}</span>
<span id="cb175-9"><a href="seating-system.html#cb175-9"></a></span>
<span id="cb175-10"><a href="seating-system.html#cb175-10"></a><span class="co"># implement a print method for our day11 class</span></span>
<span id="cb175-11"><a href="seating-system.html#cb175-11"></a>print.day11 &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...) {</span>
<span id="cb175-12"><a href="seating-system.html#cb175-12"></a>  <span class="kw">cat</span>(<span class="kw">paste</span>(<span class="kw">apply</span>(x, <span class="dv">1</span>, paste, <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>), <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb175-13"><a href="seating-system.html#cb175-13"></a>}</span>
<span id="cb175-14"><a href="seating-system.html#cb175-14"></a></span>
<span id="cb175-15"><a href="seating-system.html#cb175-15"></a>psample &lt;-<span class="st"> </span><span class="kw">process_input</span>(sample)</span>
<span id="cb175-16"><a href="seating-system.html#cb175-16"></a>pactual &lt;-<span class="st"> </span><span class="kw">process_input</span>(actual)</span></code></pre></div>
<p>We can now have a quick look at our sample input:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="seating-system.html#cb176-1"></a>psample</span></code></pre></div>
<pre><code>## ............
## .L.LL.LL.LL.
## .LLLLLLL.LL.
## .L.L.L..L...
## .LLLL.LL.LL.
## .L.LL.LL.LL.
## .L.LLLLL.LL.
## ...L.L......
## .LLLLLLLLLL.
## .L.LLLLLL.L.
## .L.LLLLL.LL.
## ............</code></pre>
<p>Now we can build a function to run n iteration’s:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="seating-system.html#cb178-1"></a>p1_run_iterations &lt;-<span class="st"> </span><span class="cf">function</span>(input, <span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">count =</span> <span class="dv">0</span>) {</span>
<span id="cb178-2"><a href="seating-system.html#cb178-2"></a>  <span class="co"># this is a recursive function, when n is less than 1 stop iterating and</span></span>
<span id="cb178-3"><a href="seating-system.html#cb178-3"></a>  <span class="co"># return whatever input is given</span></span>
<span id="cb178-4"><a href="seating-system.html#cb178-4"></a>  <span class="cf">if</span> (n <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>) <span class="kw">return</span> (<span class="kw">list</span>(<span class="dt">input =</span> input, <span class="dt">count =</span> count))</span>
<span id="cb178-5"><a href="seating-system.html#cb178-5"></a>  </span>
<span id="cb178-6"><a href="seating-system.html#cb178-6"></a>  <span class="co"># take a copy of the current state - we will modify this copied state and</span></span>
<span id="cb178-7"><a href="seating-system.html#cb178-7"></a>  <span class="co"># return it for the next iteration</span></span>
<span id="cb178-8"><a href="seating-system.html#cb178-8"></a>  next_state &lt;-<span class="st"> </span>input</span>
<span id="cb178-9"><a href="seating-system.html#cb178-9"></a>  <span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>(<span class="kw">nrow</span>(input) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) {</span>
<span id="cb178-10"><a href="seating-system.html#cb178-10"></a>    <span class="cf">for</span> (c <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>(<span class="kw">ncol</span>(input) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) {</span>
<span id="cb178-11"><a href="seating-system.html#cb178-11"></a>      <span class="co"># skip this cell if it&#39;s a .</span></span>
<span id="cb178-12"><a href="seating-system.html#cb178-12"></a>      <span class="cf">if</span> (input[r, c] <span class="op">==</span><span class="st"> &quot;.&quot;</span>) <span class="cf">next</span>()</span>
<span id="cb178-13"><a href="seating-system.html#cb178-13"></a>      <span class="co"># get adjacent seats</span></span>
<span id="cb178-14"><a href="seating-system.html#cb178-14"></a>      adjacent &lt;-<span class="st"> </span><span class="kw">c</span>(input[r <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, c <span class="op">-</span><span class="st"> </span><span class="dv">1</span>],</span>
<span id="cb178-15"><a href="seating-system.html#cb178-15"></a>                    input[r <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, c    ],</span>
<span id="cb178-16"><a href="seating-system.html#cb178-16"></a>                    input[r <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, c <span class="op">+</span><span class="st"> </span><span class="dv">1</span>],</span>
<span id="cb178-17"><a href="seating-system.html#cb178-17"></a>                    input[r    , c <span class="op">-</span><span class="st"> </span><span class="dv">1</span>],</span>
<span id="cb178-18"><a href="seating-system.html#cb178-18"></a>                    input[r    , c <span class="op">+</span><span class="st"> </span><span class="dv">1</span>],</span>
<span id="cb178-19"><a href="seating-system.html#cb178-19"></a>                    input[r <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, c <span class="op">-</span><span class="st"> </span><span class="dv">1</span>],</span>
<span id="cb178-20"><a href="seating-system.html#cb178-20"></a>                    input[r <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, c    ],</span>
<span id="cb178-21"><a href="seating-system.html#cb178-21"></a>                    input[r <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, c <span class="op">+</span><span class="st"> </span><span class="dv">1</span>])</span>
<span id="cb178-22"><a href="seating-system.html#cb178-22"></a>      <span class="co"># count how many are occupied</span></span>
<span id="cb178-23"><a href="seating-system.html#cb178-23"></a>      occupied &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">ifelse</span>(adjacent <span class="op">==</span><span class="st"> &quot;#&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb178-24"><a href="seating-system.html#cb178-24"></a>      </span>
<span id="cb178-25"><a href="seating-system.html#cb178-25"></a>      <span class="cf">if</span> (input[r, c] <span class="op">==</span><span class="st"> &quot;L&quot;</span>) {</span>
<span id="cb178-26"><a href="seating-system.html#cb178-26"></a>        <span class="cf">if</span> (occupied <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb178-27"><a href="seating-system.html#cb178-27"></a>          next_state[r, c] &lt;-<span class="st"> &quot;#&quot;</span></span>
<span id="cb178-28"><a href="seating-system.html#cb178-28"></a>        }</span>
<span id="cb178-29"><a href="seating-system.html#cb178-29"></a>      } <span class="cf">else</span> {</span>
<span id="cb178-30"><a href="seating-system.html#cb178-30"></a>        <span class="co"># it can only be &quot;#&quot; now</span></span>
<span id="cb178-31"><a href="seating-system.html#cb178-31"></a>        <span class="cf">if</span> (occupied <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span>) {</span>
<span id="cb178-32"><a href="seating-system.html#cb178-32"></a>          next_state[r, c] &lt;-<span class="st"> &quot;L&quot;</span></span>
<span id="cb178-33"><a href="seating-system.html#cb178-33"></a>        }</span>
<span id="cb178-34"><a href="seating-system.html#cb178-34"></a>      }</span>
<span id="cb178-35"><a href="seating-system.html#cb178-35"></a>    }</span>
<span id="cb178-36"><a href="seating-system.html#cb178-36"></a>  }</span>
<span id="cb178-37"><a href="seating-system.html#cb178-37"></a>  </span>
<span id="cb178-38"><a href="seating-system.html#cb178-38"></a>  <span class="cf">if</span> (<span class="kw">all</span>(next_state <span class="op">==</span><span class="st"> </span>input)) {</span>
<span id="cb178-39"><a href="seating-system.html#cb178-39"></a>    <span class="kw">return</span> (<span class="kw">list</span>(<span class="dt">input =</span> input, <span class="dt">count =</span> count))</span>
<span id="cb178-40"><a href="seating-system.html#cb178-40"></a>  }</span>
<span id="cb178-41"><a href="seating-system.html#cb178-41"></a>  </span>
<span id="cb178-42"><a href="seating-system.html#cb178-42"></a>  <span class="co"># run the next itertion, decreasing n by 1</span></span>
<span id="cb178-43"><a href="seating-system.html#cb178-43"></a>  <span class="kw">p1_run_iterations</span>(next_state, n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, count <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb178-44"><a href="seating-system.html#cb178-44"></a>}</span></code></pre></div>
<p>We can now test our function runs as expected on the sample.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="seating-system.html#cb179-1"></a><span class="kw">p1_run_iterations</span>(psample)</span></code></pre></div>
<pre><code>## $input
## ............
## .#.##.##.##.
## .#######.##.
## .#.#.#..#...
## .####.##.##.
## .#.##.##.##.
## .#.#####.##.
## ...#.#......
## .##########.
## .#.######.#.
## .#.#####.##.
## ............ 
## 
## $count
## [1] 1</code></pre>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="seating-system.html#cb181-1"></a><span class="kw">p1_run_iterations</span>(psample, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## $input
## ............
## .#.LL.L#.##.
## .#LLLLLL.L#.
## .L.L.L..L...
## .#LLL.LL.L#.
## .#.LL.LL.LL.
## .#.LLLL#.##.
## ...L.L......
## .#LLLLLLLL#.
## .#.LLLLLL.L.
## .#.#LLLL.##.
## ............ 
## 
## $count
## [1] 2</code></pre>
<p>These match the examples, we just need to check it terminates correctly:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="seating-system.html#cb183-1"></a>p1s &lt;-<span class="st"> </span><span class="kw">p1_run_iterations</span>(psample, <span class="ot">Inf</span>)</span>
<span id="cb183-2"><a href="seating-system.html#cb183-2"></a>p1s<span class="op">$</span>count <span class="op">==</span><span class="st"> </span><span class="dv">5</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>We just need a way to count the seats occupied now:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="seating-system.html#cb185-1"></a>count_seats &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb185-2"><a href="seating-system.html#cb185-2"></a>  <span class="kw">sum</span>(x<span class="op">$</span>input <span class="op">==</span><span class="st"> &quot;#&quot;</span>)</span>
<span id="cb185-3"><a href="seating-system.html#cb185-3"></a>}</span></code></pre></div>
<p>Which we can run on the variable <code>p1s</code> from above:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="seating-system.html#cb186-1"></a><span class="kw">count_seats</span>(p1s) <span class="op">==</span><span class="st"> </span><span class="dv">37</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>While this does run, it’s not particular fast on the actual data. We come back to part 1 later.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="seating-system.html#cb188-1"></a><span class="co"># disabled chunk</span></span>
<span id="cb188-2"><a href="seating-system.html#cb188-2"></a>pactual <span class="op">%&gt;%</span></span>
<span id="cb188-3"><a href="seating-system.html#cb188-3"></a><span class="st">  </span><span class="kw">p1_run_iterations</span>(<span class="ot">Inf</span>) <span class="op">%&gt;%</span></span>
<span id="cb188-4"><a href="seating-system.html#cb188-4"></a><span class="st">  </span><span class="kw">count_seats</span>()</span></code></pre></div>
</div>
<div id="part-2-10" class="section level2">
<h2><span class="header-section-number">11.2</span> Part 2</h2>
<p>We now need to modify our run iterations function. I am going to embed a function that will search for the first seat,
and update the tolerance from 4 to 5.</p>
<p>In order to speed up computation we first calculate the “first seat” found from any position. In order to remember these
seats we switch from a recursive function to use a loop. Otherwise, the function remains the same as in part 1.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="seating-system.html#cb189-1"></a>p2_run_iterations &lt;-<span class="st"> </span><span class="cf">function</span>(input, n) {</span>
<span id="cb189-2"><a href="seating-system.html#cb189-2"></a>  <span class="co"># create a function to find the first seat that can be seen from r, c in the</span></span>
<span id="cb189-3"><a href="seating-system.html#cb189-3"></a>  <span class="co"># direction rd, cd. rd / cd should be 1, -1 or 0, but both should not be 0</span></span>
<span id="cb189-4"><a href="seating-system.html#cb189-4"></a>  find_first_seat &lt;-<span class="st"> </span><span class="cf">function</span>(r, c, rd, cd) {</span>
<span id="cb189-5"><a href="seating-system.html#cb189-5"></a>    rr &lt;-<span class="st"> </span>r</span>
<span id="cb189-6"><a href="seating-system.html#cb189-6"></a>    cc &lt;-<span class="st"> </span>c</span>
<span id="cb189-7"><a href="seating-system.html#cb189-7"></a>    <span class="cf">if</span> (input[rr, cc] <span class="op">==</span><span class="st"> &quot;.&quot;</span>) {</span>
<span id="cb189-8"><a href="seating-system.html#cb189-8"></a>      <span class="co"># return a cell that will be a &quot;.&quot;</span></span>
<span id="cb189-9"><a href="seating-system.html#cb189-9"></a>      <span class="kw">return</span> (<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb189-10"><a href="seating-system.html#cb189-10"></a>    }</span>
<span id="cb189-11"><a href="seating-system.html#cb189-11"></a>    <span class="cf">repeat</span> {</span>
<span id="cb189-12"><a href="seating-system.html#cb189-12"></a>      rr &lt;-<span class="st"> </span>rr <span class="op">+</span><span class="st"> </span>rd</span>
<span id="cb189-13"><a href="seating-system.html#cb189-13"></a>      cc &lt;-<span class="st"> </span>cc <span class="op">+</span><span class="st"> </span>cd</span>
<span id="cb189-14"><a href="seating-system.html#cb189-14"></a>      <span class="cf">if</span> (rr <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>rr <span class="op">&gt;</span><span class="st"> </span><span class="kw">nrow</span>(input) <span class="op">|</span></span>
<span id="cb189-15"><a href="seating-system.html#cb189-15"></a><span class="st">          </span>cc <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>cc <span class="op">&gt;</span><span class="st"> </span><span class="kw">ncol</span>(input) ) {</span>
<span id="cb189-16"><a href="seating-system.html#cb189-16"></a>        <span class="co"># return a cell that will be a &quot;.&quot;</span></span>
<span id="cb189-17"><a href="seating-system.html#cb189-17"></a>        <span class="kw">return</span> (<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb189-18"><a href="seating-system.html#cb189-18"></a>      } <span class="cf">else</span> <span class="cf">if</span> (input[rr, cc] <span class="op">!=</span><span class="st"> &quot;.&quot;</span>) {</span>
<span id="cb189-19"><a href="seating-system.html#cb189-19"></a>        <span class="co"># return the indexes</span></span>
<span id="cb189-20"><a href="seating-system.html#cb189-20"></a>        <span class="kw">return</span> (<span class="kw">c</span>(rr, cc))</span>
<span id="cb189-21"><a href="seating-system.html#cb189-21"></a>      }</span>
<span id="cb189-22"><a href="seating-system.html#cb189-22"></a>    }</span>
<span id="cb189-23"><a href="seating-system.html#cb189-23"></a>  }</span>
<span id="cb189-24"><a href="seating-system.html#cb189-24"></a>  </span>
<span id="cb189-25"><a href="seating-system.html#cb189-25"></a>  first_seats &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">2</span><span class="op">:</span>(<span class="kw">nrow</span>(input) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="cf">function</span>(r) {</span>
<span id="cb189-26"><a href="seating-system.html#cb189-26"></a>    <span class="kw">map</span>(<span class="dv">2</span><span class="op">:</span>(<span class="kw">ncol</span>(input) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="cf">function</span>(c) {</span>
<span id="cb189-27"><a href="seating-system.html#cb189-27"></a>      <span class="kw">list</span>(</span>
<span id="cb189-28"><a href="seating-system.html#cb189-28"></a>        <span class="dt">rd =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">-1</span>,  <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">1</span>,  <span class="dv">1</span>),</span>
<span id="cb189-29"><a href="seating-system.html#cb189-29"></a>        <span class="dt">cd =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,  <span class="dv">0</span>,  <span class="dv">1</span>, <span class="dv">-1</span>,  <span class="dv">1</span>, <span class="dv">-1</span>,  <span class="dv">0</span>,  <span class="dv">1</span>)</span>
<span id="cb189-30"><a href="seating-system.html#cb189-30"></a>      ) <span class="op">%&gt;%</span></span>
<span id="cb189-31"><a href="seating-system.html#cb189-31"></a><span class="st">        </span><span class="kw">pmap</span>(find_first_seat, <span class="dt">r =</span> r, <span class="dt">c =</span> c) <span class="op">%&gt;%</span></span>
<span id="cb189-32"><a href="seating-system.html#cb189-32"></a><span class="st">        </span><span class="kw">discard</span>(<span class="kw">compose</span>(any, is.na))</span>
<span id="cb189-33"><a href="seating-system.html#cb189-33"></a>    })</span>
<span id="cb189-34"><a href="seating-system.html#cb189-34"></a>  })</span>
<span id="cb189-35"><a href="seating-system.html#cb189-35"></a>  </span>
<span id="cb189-36"><a href="seating-system.html#cb189-36"></a>  count &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb189-37"><a href="seating-system.html#cb189-37"></a>  state &lt;-<span class="st"> </span>input</span>
<span id="cb189-38"><a href="seating-system.html#cb189-38"></a>  <span class="cf">while</span> (count <span class="op">&lt;</span><span class="st"> </span>n) {</span>
<span id="cb189-39"><a href="seating-system.html#cb189-39"></a>    <span class="co"># take a copy of the current state - we will modify this copied state and</span></span>
<span id="cb189-40"><a href="seating-system.html#cb189-40"></a>    <span class="co"># return it for the next iteration</span></span>
<span id="cb189-41"><a href="seating-system.html#cb189-41"></a>    next_state &lt;-<span class="st"> </span>state</span>
<span id="cb189-42"><a href="seating-system.html#cb189-42"></a>    </span>
<span id="cb189-43"><a href="seating-system.html#cb189-43"></a>    <span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>(<span class="kw">nrow</span>(state) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) {</span>
<span id="cb189-44"><a href="seating-system.html#cb189-44"></a>      <span class="cf">for</span> (c <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>(<span class="kw">ncol</span>(state) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) {</span>
<span id="cb189-45"><a href="seating-system.html#cb189-45"></a>        <span class="co"># skip this cell if it&#39;s a .</span></span>
<span id="cb189-46"><a href="seating-system.html#cb189-46"></a>        <span class="cf">if</span> (state[r, c] <span class="op">==</span><span class="st"> &quot;.&quot;</span>) <span class="cf">next</span>()</span>
<span id="cb189-47"><a href="seating-system.html#cb189-47"></a>        </span>
<span id="cb189-48"><a href="seating-system.html#cb189-48"></a>        <span class="co"># our first seats only iterated over the &quot;inside&quot; range, so we need to</span></span>
<span id="cb189-49"><a href="seating-system.html#cb189-49"></a>        <span class="co"># subtract 1 from the r and c index</span></span>
<span id="cb189-50"><a href="seating-system.html#cb189-50"></a>        adjacent &lt;-<span class="st"> </span><span class="kw">map_chr</span>(first_seats[[r <span class="op">-</span><span class="st"> </span><span class="dv">1</span>]][[c <span class="op">-</span><span class="st"> </span><span class="dv">1</span>]],</span>
<span id="cb189-51"><a href="seating-system.html#cb189-51"></a>                            <span class="op">~</span>state[.x[[<span class="dv">1</span>]], .x[[<span class="dv">2</span>]]])</span>
<span id="cb189-52"><a href="seating-system.html#cb189-52"></a>        </span>
<span id="cb189-53"><a href="seating-system.html#cb189-53"></a>        <span class="co"># count how many are occupied</span></span>
<span id="cb189-54"><a href="seating-system.html#cb189-54"></a>        occupied &lt;-<span class="st"> </span><span class="kw">sum</span>(adjacent <span class="op">==</span><span class="st"> &quot;#&quot;</span>)</span>
<span id="cb189-55"><a href="seating-system.html#cb189-55"></a>        </span>
<span id="cb189-56"><a href="seating-system.html#cb189-56"></a>        <span class="cf">if</span> (state[r, c] <span class="op">==</span><span class="st"> &quot;L&quot;</span>) {</span>
<span id="cb189-57"><a href="seating-system.html#cb189-57"></a>          <span class="cf">if</span> (occupied <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb189-58"><a href="seating-system.html#cb189-58"></a>            next_state[r, c] &lt;-<span class="st"> &quot;#&quot;</span></span>
<span id="cb189-59"><a href="seating-system.html#cb189-59"></a>          }</span>
<span id="cb189-60"><a href="seating-system.html#cb189-60"></a>        } <span class="cf">else</span> {</span>
<span id="cb189-61"><a href="seating-system.html#cb189-61"></a>          <span class="co"># it can only be &quot;#&quot; now</span></span>
<span id="cb189-62"><a href="seating-system.html#cb189-62"></a>          <span class="cf">if</span> (occupied <span class="op">&gt;=</span><span class="st"> </span><span class="dv">5</span>) {</span>
<span id="cb189-63"><a href="seating-system.html#cb189-63"></a>            next_state[r, c] &lt;-<span class="st"> &quot;L&quot;</span></span>
<span id="cb189-64"><a href="seating-system.html#cb189-64"></a>          }</span>
<span id="cb189-65"><a href="seating-system.html#cb189-65"></a>        }</span>
<span id="cb189-66"><a href="seating-system.html#cb189-66"></a>      }</span>
<span id="cb189-67"><a href="seating-system.html#cb189-67"></a>    }</span>
<span id="cb189-68"><a href="seating-system.html#cb189-68"></a>    </span>
<span id="cb189-69"><a href="seating-system.html#cb189-69"></a>    <span class="cf">if</span> (<span class="kw">all</span>(next_state <span class="op">==</span><span class="st"> </span>state)) {</span>
<span id="cb189-70"><a href="seating-system.html#cb189-70"></a>      <span class="cf">break</span>()</span>
<span id="cb189-71"><a href="seating-system.html#cb189-71"></a>    }</span>
<span id="cb189-72"><a href="seating-system.html#cb189-72"></a>    </span>
<span id="cb189-73"><a href="seating-system.html#cb189-73"></a>    state &lt;-<span class="st"> </span>next_state</span>
<span id="cb189-74"><a href="seating-system.html#cb189-74"></a>    count &lt;-<span class="st"> </span>count <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb189-75"><a href="seating-system.html#cb189-75"></a>  }</span>
<span id="cb189-76"><a href="seating-system.html#cb189-76"></a>  </span>
<span id="cb189-77"><a href="seating-system.html#cb189-77"></a>  <span class="kw">list</span>(<span class="dt">input =</span> state, <span class="dt">count =</span> count)</span>
<span id="cb189-78"><a href="seating-system.html#cb189-78"></a>}</span></code></pre></div>
<p>We can test our function works as expected after 1 iteration:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="seating-system.html#cb190-1"></a>psample <span class="op">%&gt;%</span></span>
<span id="cb190-2"><a href="seating-system.html#cb190-2"></a><span class="st">  </span><span class="kw">p2_run_iterations</span>(<span class="dv">1</span>) </span></code></pre></div>
<pre><code>## $input
## ............
## .#.##.##.##.
## .#######.##.
## .#.#.#..#...
## .####.##.##.
## .#.##.##.##.
## .#.#####.##.
## ...#.#......
## .##########.
## .#.######.#.
## .#.#####.##.
## ............ 
## 
## $count
## [1] 1</code></pre>
<p>And after 2 iterations:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="seating-system.html#cb192-1"></a>psample <span class="op">%&gt;%</span></span>
<span id="cb192-2"><a href="seating-system.html#cb192-2"></a><span class="st">  </span><span class="kw">p2_run_iterations</span>(<span class="dv">2</span>) </span></code></pre></div>
<pre><code>## $input
## ............
## .#.LL.LL.L#.
## .#LLLLLL.LL.
## .L.L.L..L...
## .LLLL.LL.LL.
## .L.LL.LL.LL.
## .L.LLLLL.LL.
## ...L.L......
## .LLLLLLLLL#.
## .#.LLLLLL.L.
## .#.LLLLL.L#.
## ............ 
## 
## $count
## [1] 2</code></pre>
<p>We can use the <code>count_seats()</code> function again to test our new function works:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="seating-system.html#cb194-1"></a>psample <span class="op">%&gt;%</span></span>
<span id="cb194-2"><a href="seating-system.html#cb194-2"></a><span class="st">  </span><span class="kw">p2_run_iterations</span>(<span class="ot">Inf</span>) <span class="op">%&gt;%</span></span>
<span id="cb194-3"><a href="seating-system.html#cb194-3"></a><span class="st">  </span><span class="kw">count_seats</span>() <span class="op">==</span><span class="st"> </span><span class="dv">26</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Again, this function runs very slowly on the actual data.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="seating-system.html#cb196-1"></a><span class="co"># disabled chunk</span></span>
<span id="cb196-2"><a href="seating-system.html#cb196-2"></a>pactual <span class="op">%&gt;%</span></span>
<span id="cb196-3"><a href="seating-system.html#cb196-3"></a><span class="st">  </span><span class="kw">p2_run_iterations</span>(<span class="ot">Inf</span>) <span class="op">%&gt;%</span></span>
<span id="cb196-4"><a href="seating-system.html#cb196-4"></a><span class="st">  </span><span class="kw">count_seats</span>()</span></code></pre></div>
</div>
<div id="solving-faster" class="section level2">
<h2><span class="header-section-number">11.3</span> Solving faster</h2>
<p>R is much better at vectorised operations, so if we could reduce the steps to summing matrices our code should run much
faster.</p>
<p>First, we are to treat our input as a matrix that contains either 0 for an unoccupied seat, 1 for an occupied seat, and
<code>NA</code> for the floor.</p>
<p>We then create functions for part 1 and for part 2 which returns 8 set’s of indices for the directions that we are to
look in for seats. These index sets will be used to return a matrix the same size as the inner part of our matrix (we
ignore the border).</p>
<p>Part 1’s function is pretty simple, we simply shift the matrix one up, one to the left, then just one up, then one up
and one to the right, etc. This function is pretty slow as we have to allocate quite a lot of memory.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="seating-system.html#cb197-1"></a>part_one &lt;-<span class="st"> </span><span class="cf">function</span>(input) {</span>
<span id="cb197-2"><a href="seating-system.html#cb197-2"></a>  nr &lt;-<span class="st"> </span><span class="kw">nrow</span>(input)</span>
<span id="cb197-3"><a href="seating-system.html#cb197-3"></a>  nc &lt;-<span class="st"> </span><span class="kw">ncol</span>(input)</span>
<span id="cb197-4"><a href="seating-system.html#cb197-4"></a>  </span>
<span id="cb197-5"><a href="seating-system.html#cb197-5"></a>  <span class="kw">cross2</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">%&gt;%</span></span>
<span id="cb197-6"><a href="seating-system.html#cb197-6"></a><span class="st">    </span><span class="kw">discard</span>(<span class="op">~</span><span class="st"> </span>.x[[<span class="dv">1</span>]] <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">&amp;&amp;</span><span class="st"> </span>.x[[<span class="dv">2</span>]] <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></span>
<span id="cb197-7"><a href="seating-system.html#cb197-7"></a><span class="st">    </span><span class="kw">map</span>(<span class="cf">function</span>(.x) {</span>
<span id="cb197-8"><a href="seating-system.html#cb197-8"></a>      <span class="kw">cross_df</span>(</span>
<span id="cb197-9"><a href="seating-system.html#cb197-9"></a>        <span class="kw">list</span>(</span>
<span id="cb197-10"><a href="seating-system.html#cb197-10"></a>          <span class="dt">row =</span> .x[[<span class="dv">1</span>]]<span class="op">:</span>(nr <span class="op">-</span><span class="st"> </span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span>.x[[<span class="dv">1</span>]]),</span>
<span id="cb197-11"><a href="seating-system.html#cb197-11"></a>          <span class="dt">col =</span> .x[[<span class="dv">2</span>]]<span class="op">:</span>(nc <span class="op">-</span><span class="st"> </span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span>.x[[<span class="dv">2</span>]])</span>
<span id="cb197-12"><a href="seating-system.html#cb197-12"></a>        )</span>
<span id="cb197-13"><a href="seating-system.html#cb197-13"></a>      ) <span class="op">%&gt;%</span></span>
<span id="cb197-14"><a href="seating-system.html#cb197-14"></a><span class="st">        </span><span class="kw">as.matrix</span>()</span>
<span id="cb197-15"><a href="seating-system.html#cb197-15"></a>    })</span>
<span id="cb197-16"><a href="seating-system.html#cb197-16"></a>}</span></code></pre></div>
<p>Part 2 is slightly more complex as we need to find the seat according to the more complex rules.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="seating-system.html#cb198-1"></a>part_two &lt;-<span class="st"> </span><span class="cf">function</span>(input) {</span>
<span id="cb198-2"><a href="seating-system.html#cb198-2"></a>  nr &lt;-<span class="st"> </span><span class="kw">nrow</span>(input)</span>
<span id="cb198-3"><a href="seating-system.html#cb198-3"></a>  nc &lt;-<span class="st"> </span><span class="kw">ncol</span>(input)</span>
<span id="cb198-4"><a href="seating-system.html#cb198-4"></a>  </span>
<span id="cb198-5"><a href="seating-system.html#cb198-5"></a>  find_in_direction &lt;-<span class="st"> </span><span class="cf">function</span>(r, c, rd, cd) {</span>
<span id="cb198-6"><a href="seating-system.html#cb198-6"></a>    ri &lt;-<span class="st"> </span>r</span>
<span id="cb198-7"><a href="seating-system.html#cb198-7"></a>    ci &lt;-<span class="st"> </span>c</span>
<span id="cb198-8"><a href="seating-system.html#cb198-8"></a>    <span class="cf">repeat</span> {</span>
<span id="cb198-9"><a href="seating-system.html#cb198-9"></a>      ri &lt;-<span class="st"> </span>ri <span class="op">+</span><span class="st"> </span>rd</span>
<span id="cb198-10"><a href="seating-system.html#cb198-10"></a>      ci &lt;-<span class="st"> </span>ci <span class="op">+</span><span class="st"> </span>cd</span>
<span id="cb198-11"><a href="seating-system.html#cb198-11"></a>      </span>
<span id="cb198-12"><a href="seating-system.html#cb198-12"></a>      <span class="co"># we have reached the boundary, exit</span></span>
<span id="cb198-13"><a href="seating-system.html#cb198-13"></a>      <span class="cf">if</span> (ri <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>ri <span class="op">&gt;</span><span class="st"> </span>nr <span class="op">|</span><span class="st"> </span>ci <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>ci <span class="op">&gt;</span><span class="st"> </span>nc) {</span>
<span id="cb198-14"><a href="seating-system.html#cb198-14"></a>        <span class="kw">return</span> (<span class="kw">list</span>(<span class="dt">row =</span> ri <span class="op">-</span><span class="st"> </span>rd, <span class="dt">col =</span> ci <span class="op">-</span><span class="st"> </span>cd))</span>
<span id="cb198-15"><a href="seating-system.html#cb198-15"></a>      }</span>
<span id="cb198-16"><a href="seating-system.html#cb198-16"></a>      <span class="co"># we have found a seat, return</span></span>
<span id="cb198-17"><a href="seating-system.html#cb198-17"></a>      <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.na</span>(input[ri, ci])) {</span>
<span id="cb198-18"><a href="seating-system.html#cb198-18"></a>        <span class="kw">return</span> (<span class="kw">list</span>(<span class="dt">row =</span> ri, <span class="dt">col =</span> ci))</span>
<span id="cb198-19"><a href="seating-system.html#cb198-19"></a>      }</span>
<span id="cb198-20"><a href="seating-system.html#cb198-20"></a>    }</span>
<span id="cb198-21"><a href="seating-system.html#cb198-21"></a>  }</span>
<span id="cb198-22"><a href="seating-system.html#cb198-22"></a> </span>
<span id="cb198-23"><a href="seating-system.html#cb198-23"></a>  <span class="co"># get the indices of each cell in the inner part of the input matrix </span></span>
<span id="cb198-24"><a href="seating-system.html#cb198-24"></a>  ixs &lt;-<span class="st"> </span><span class="kw">cross_df</span>(<span class="kw">list</span>(<span class="dt">r =</span> <span class="dv">2</span><span class="op">:</span>(nr <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="dt">c =</span> <span class="dv">2</span><span class="op">:</span>(nc <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)))</span>
<span id="cb198-25"><a href="seating-system.html#cb198-25"></a>  </span>
<span id="cb198-26"><a href="seating-system.html#cb198-26"></a>  <span class="co"># now find the values in each direction</span></span>
<span id="cb198-27"><a href="seating-system.html#cb198-27"></a>  <span class="kw">list</span>(</span>
<span id="cb198-28"><a href="seating-system.html#cb198-28"></a>    <span class="kw">pmap_dfr</span>(ixs, find_in_direction, <span class="dv">-1</span>, <span class="dv">-1</span>),</span>
<span id="cb198-29"><a href="seating-system.html#cb198-29"></a>    <span class="kw">pmap_dfr</span>(ixs, find_in_direction, <span class="dv">-1</span>,  <span class="dv">0</span>),</span>
<span id="cb198-30"><a href="seating-system.html#cb198-30"></a>    <span class="kw">pmap_dfr</span>(ixs, find_in_direction, <span class="dv">-1</span>,  <span class="dv">1</span>),</span>
<span id="cb198-31"><a href="seating-system.html#cb198-31"></a>    <span class="kw">pmap_dfr</span>(ixs, find_in_direction,  <span class="dv">0</span>, <span class="dv">-1</span>),</span>
<span id="cb198-32"><a href="seating-system.html#cb198-32"></a>    <span class="kw">pmap_dfr</span>(ixs, find_in_direction,  <span class="dv">0</span>,  <span class="dv">1</span>),</span>
<span id="cb198-33"><a href="seating-system.html#cb198-33"></a>    <span class="kw">pmap_dfr</span>(ixs, find_in_direction,  <span class="dv">1</span>, <span class="dv">-1</span>),</span>
<span id="cb198-34"><a href="seating-system.html#cb198-34"></a>    <span class="kw">pmap_dfr</span>(ixs, find_in_direction,  <span class="dv">1</span>,  <span class="dv">0</span>),</span>
<span id="cb198-35"><a href="seating-system.html#cb198-35"></a>    <span class="kw">pmap_dfr</span>(ixs, find_in_direction,  <span class="dv">1</span>,  <span class="dv">1</span>)</span>
<span id="cb198-36"><a href="seating-system.html#cb198-36"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb198-37"><a href="seating-system.html#cb198-37"></a><span class="st">    </span><span class="kw">map</span>(as.matrix)</span>
<span id="cb198-38"><a href="seating-system.html#cb198-38"></a>}</span></code></pre></div>
<p>We now create a solving function, which takes the data as the first argument, either <code>part_one()</code> or <code>part_two()</code> as the
second argument, and the tolerance (4 for part 1, 5 for part 2).</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="seating-system.html#cb199-1"></a>solve &lt;-<span class="st"> </span><span class="cf">function</span>(x, add_mat_fn, tolerance) {</span>
<span id="cb199-2"><a href="seating-system.html#cb199-2"></a>  input &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">unclass</span>(x) <span class="op">==</span><span class="st"> &quot;L&quot;</span>, <span class="dv">0</span>, <span class="ot">NA</span>)</span>
<span id="cb199-3"><a href="seating-system.html#cb199-3"></a>  </span>
<span id="cb199-4"><a href="seating-system.html#cb199-4"></a>  nr &lt;-<span class="st"> </span><span class="kw">nrow</span>(input)</span>
<span id="cb199-5"><a href="seating-system.html#cb199-5"></a>  nc &lt;-<span class="st"> </span><span class="kw">ncol</span>(input)</span>
<span id="cb199-6"><a href="seating-system.html#cb199-6"></a>  </span>
<span id="cb199-7"><a href="seating-system.html#cb199-7"></a>  add_mat_ix &lt;-<span class="st"> </span><span class="kw">add_mat_fn</span>(input)</span>
<span id="cb199-8"><a href="seating-system.html#cb199-8"></a>  </span>
<span id="cb199-9"><a href="seating-system.html#cb199-9"></a>  <span class="cf">repeat</span> {</span>
<span id="cb199-10"><a href="seating-system.html#cb199-10"></a>    <span class="co"># use this to check later if our matrix has changed</span></span>
<span id="cb199-11"><a href="seating-system.html#cb199-11"></a>    t &lt;-<span class="st"> </span>input</span>
<span id="cb199-12"><a href="seating-system.html#cb199-12"></a>      </span>
<span id="cb199-13"><a href="seating-system.html#cb199-13"></a>    <span class="co"># use our matrix indices, find the values for the 8 shifted matrices, then</span></span>
<span id="cb199-14"><a href="seating-system.html#cb199-14"></a>    <span class="co"># add the 8 matrices together to give us one matrix that tells us how many</span></span>
<span id="cb199-15"><a href="seating-system.html#cb199-15"></a>    <span class="co"># adjacent seats are occupied</span></span>
<span id="cb199-16"><a href="seating-system.html#cb199-16"></a>    add_mat &lt;-<span class="st"> </span>add_mat_ix <span class="op">%&gt;%</span></span>
<span id="cb199-17"><a href="seating-system.html#cb199-17"></a><span class="st">      </span><span class="kw">map</span>(<span class="op">~</span>input[.x] <span class="op">%&gt;%</span></span>
<span id="cb199-18"><a href="seating-system.html#cb199-18"></a><span class="st">            </span><span class="kw">replace_na</span>(<span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb199-19"><a href="seating-system.html#cb199-19"></a><span class="st">            </span><span class="kw">matrix</span>(<span class="dt">nrow =</span> nr <span class="op">-</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">ncol =</span> nc <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">%&gt;%</span></span>
<span id="cb199-20"><a href="seating-system.html#cb199-20"></a><span class="st">      </span><span class="kw">reduce</span>(<span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</span>
<span id="cb199-21"><a href="seating-system.html#cb199-21"></a>    </span>
<span id="cb199-22"><a href="seating-system.html#cb199-22"></a>    <span class="co"># find the unoccupied seats in the input</span></span>
<span id="cb199-23"><a href="seating-system.html#cb199-23"></a>    y &lt;-<span class="st"> </span><span class="kw">which</span>(input <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dt">arr.ind =</span> <span class="ot">TRUE</span>)</span>
<span id="cb199-24"><a href="seating-system.html#cb199-24"></a>    <span class="co"># and the occupied seats</span></span>
<span id="cb199-25"><a href="seating-system.html#cb199-25"></a>    z &lt;-<span class="st"> </span><span class="kw">which</span>(input <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">arr.ind =</span> <span class="ot">TRUE</span>)</span>
<span id="cb199-26"><a href="seating-system.html#cb199-26"></a>    </span>
<span id="cb199-27"><a href="seating-system.html#cb199-27"></a>    <span class="co"># update the unoccupied seats</span></span>
<span id="cb199-28"><a href="seating-system.html#cb199-28"></a>    input[y] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(add_mat[y <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb199-29"><a href="seating-system.html#cb199-29"></a>    <span class="co"># update the occupied seats</span></span>
<span id="cb199-30"><a href="seating-system.html#cb199-30"></a>    input[z] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(add_mat[z <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">&lt;</span><span class="st">  </span>tolerance)</span>
<span id="cb199-31"><a href="seating-system.html#cb199-31"></a>    </span>
<span id="cb199-32"><a href="seating-system.html#cb199-32"></a>    <span class="co"># check to see if our matrix has changed</span></span>
<span id="cb199-33"><a href="seating-system.html#cb199-33"></a>    <span class="cf">if</span> (<span class="kw">all</span>(t <span class="op">==</span><span class="st"> </span>input, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="cf">break</span>()</span>
<span id="cb199-34"><a href="seating-system.html#cb199-34"></a>  }</span>
<span id="cb199-35"><a href="seating-system.html#cb199-35"></a>  <span class="co"># now just return the number of occupied seats</span></span>
<span id="cb199-36"><a href="seating-system.html#cb199-36"></a>  <span class="kw">sum</span>(input, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb199-37"><a href="seating-system.html#cb199-37"></a>}</span></code></pre></div>
<p>We can now run our new function’s and see if they give us the same results as above:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="seating-system.html#cb200-1"></a><span class="kw">solve</span>(psample, part_one, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 37</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="seating-system.html#cb202-1"></a><span class="kw">solve</span>(pactual, part_one, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 2483</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="seating-system.html#cb204-1"></a><span class="kw">solve</span>(psample, part_two, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 26</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="seating-system.html#cb206-1"></a><span class="kw">solve</span>(pactual, part_two, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 2285</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="adapter-array.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rain-risk.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
