<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Day 14 Docking Data | Advent of Code 2020</title>
  <meta name="description" content="My attempt to complete AOC 2020 in R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Day 14 Docking Data | Advent of Code 2020" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="My attempt to complete AOC 2020 in R" />
  <meta name="github-repo" content="tomjemmett/advent-of-code-2020" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Day 14 Docking Data | Advent of Code 2020" />
  
  <meta name="twitter:description" content="My attempt to complete AOC 2020 in R" />
  

<meta name="author" content="Tom Jemmett" />


<meta name="date" content="2020-12-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="shuttle-search.html"/>
<link rel="next" href="rambunctious-recitation.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Advent of Code 2020</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="report-repair.html"><a href="report-repair.html"><i class="fa fa-check"></i><b>1</b> Report Repair</a><ul>
<li class="chapter" data-level="1.1" data-path="report-repair.html"><a href="report-repair.html#part-1"><i class="fa fa-check"></i><b>1.1</b> Part 1</a><ul>
<li class="chapter" data-level="1.1.1" data-path="report-repair.html"><a href="report-repair.html#is-the-improved-algorithm-any-better"><i class="fa fa-check"></i><b>1.1.1</b> is the improved algorithm any better?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="report-repair.html"><a href="report-repair.html#part-2"><i class="fa fa-check"></i><b>1.2</b> Part 2</a><ul>
<li class="chapter" data-level="1.2.1" data-path="report-repair.html"><a href="report-repair.html#is-our-improved-algorithm-better-this-time"><i class="fa fa-check"></i><b>1.2.1</b> Is our improved algorithm better this time?</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="report-repair.html"><a href="report-repair.html#extra-implementing-in-python"><i class="fa fa-check"></i><b>1.3</b> Extra: Implementing in Python</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="password-philosophy.html"><a href="password-philosophy.html"><i class="fa fa-check"></i><b>2</b> Password Philosophy</a><ul>
<li class="chapter" data-level="2.1" data-path="password-philosophy.html"><a href="password-philosophy.html#part-1-1"><i class="fa fa-check"></i><b>2.1</b> Part 1</a></li>
<li class="chapter" data-level="2.2" data-path="password-philosophy.html"><a href="password-philosophy.html#part-2-1"><i class="fa fa-check"></i><b>2.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="toboggan-trajectory.html"><a href="toboggan-trajectory.html"><i class="fa fa-check"></i><b>3</b> Toboggan Trajectory</a><ul>
<li class="chapter" data-level="3.1" data-path="toboggan-trajectory.html"><a href="toboggan-trajectory.html#part-1-2"><i class="fa fa-check"></i><b>3.1</b> Part 1</a></li>
<li class="chapter" data-level="3.2" data-path="toboggan-trajectory.html"><a href="toboggan-trajectory.html#part-2-2"><i class="fa fa-check"></i><b>3.2</b> Part 2</a></li>
<li class="chapter" data-level="3.3" data-path="toboggan-trajectory.html"><a href="toboggan-trajectory.html#extra-is-there-a-path-that-minimises-the-number-of-trees-you-encounter"><i class="fa fa-check"></i><b>3.3</b> Extra: Is there a path that minimises the number of trees you encounter?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="passport-processing.html"><a href="passport-processing.html"><i class="fa fa-check"></i><b>4</b> Passport Processing</a><ul>
<li class="chapter" data-level="4.1" data-path="passport-processing.html"><a href="passport-processing.html#part-1-3"><i class="fa fa-check"></i><b>4.1</b> Part 1</a></li>
<li class="chapter" data-level="4.2" data-path="passport-processing.html"><a href="passport-processing.html#part-2-3"><i class="fa fa-check"></i><b>4.2</b> Part 2</a></li>
<li class="chapter" data-level="4.3" data-path="passport-processing.html"><a href="passport-processing.html#extra-solving-with-regular-expressions"><i class="fa fa-check"></i><b>4.3</b> Extra: Solving with regular expressions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="binary-boarding.html"><a href="binary-boarding.html"><i class="fa fa-check"></i><b>5</b> Binary Boarding</a><ul>
<li class="chapter" data-level="5.1" data-path="binary-boarding.html"><a href="binary-boarding.html#part-1-4"><i class="fa fa-check"></i><b>5.1</b> Part 1</a></li>
<li class="chapter" data-level="5.2" data-path="binary-boarding.html"><a href="binary-boarding.html#part-2-4"><i class="fa fa-check"></i><b>5.2</b> Part 2</a></li>
<li class="chapter" data-level="5.3" data-path="binary-boarding.html"><a href="binary-boarding.html#extra-solving-algebraicly"><i class="fa fa-check"></i><b>5.3</b> Extra: Solving algebraicly</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="custom-customs.html"><a href="custom-customs.html"><i class="fa fa-check"></i><b>6</b> Custom Customs</a><ul>
<li class="chapter" data-level="6.1" data-path="custom-customs.html"><a href="custom-customs.html#part-1-5"><i class="fa fa-check"></i><b>6.1</b> Part 1</a></li>
<li class="chapter" data-level="6.2" data-path="custom-customs.html"><a href="custom-customs.html#part-2-5"><i class="fa fa-check"></i><b>6.2</b> Part 2</a></li>
<li class="chapter" data-level="6.3" data-path="custom-customs.html"><a href="custom-customs.html#extra-solving-part-1-2-with-set-functions"><i class="fa fa-check"></i><b>6.3</b> Extra: solving part 1 &amp; 2 with set functions</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="handy-haversacks.html"><a href="handy-haversacks.html"><i class="fa fa-check"></i><b>7</b> Handy Haversacks</a><ul>
<li class="chapter" data-level="7.1" data-path="handy-haversacks.html"><a href="handy-haversacks.html#part-1-6"><i class="fa fa-check"></i><b>7.1</b> Part 1</a></li>
<li class="chapter" data-level="7.2" data-path="handy-haversacks.html"><a href="handy-haversacks.html#part-2-6"><i class="fa fa-check"></i><b>7.2</b> Part 2</a></li>
<li class="chapter" data-level="7.3" data-path="handy-haversacks.html"><a href="handy-haversacks.html#extra-alternative-solution-to-part-2"><i class="fa fa-check"></i><b>7.3</b> Extra: alternative solution to part 2</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="handheld-halting.html"><a href="handheld-halting.html"><i class="fa fa-check"></i><b>8</b> Handheld Halting</a><ul>
<li class="chapter" data-level="8.1" data-path="handheld-halting.html"><a href="handheld-halting.html#part-1-7"><i class="fa fa-check"></i><b>8.1</b> Part 1</a></li>
<li class="chapter" data-level="8.2" data-path="handheld-halting.html"><a href="handheld-halting.html#part-2-7"><i class="fa fa-check"></i><b>8.2</b> Part 2</a></li>
<li class="chapter" data-level="8.3" data-path="handheld-halting.html"><a href="handheld-halting.html#extra-update-the-computer-class"><i class="fa fa-check"></i><b>8.3</b> Extra: update the computer class</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="encoding-error.html"><a href="encoding-error.html"><i class="fa fa-check"></i><b>9</b> Encoding Error</a><ul>
<li class="chapter" data-level="9.1" data-path="encoding-error.html"><a href="encoding-error.html#part-1-8"><i class="fa fa-check"></i><b>9.1</b> Part 1</a></li>
<li class="chapter" data-level="9.2" data-path="encoding-error.html"><a href="encoding-error.html#part-2-8"><i class="fa fa-check"></i><b>9.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="adapter-array.html"><a href="adapter-array.html"><i class="fa fa-check"></i><b>10</b> Adapter Array</a><ul>
<li class="chapter" data-level="10.1" data-path="adapter-array.html"><a href="adapter-array.html#part-1-9"><i class="fa fa-check"></i><b>10.1</b> Part 1</a></li>
<li class="chapter" data-level="10.2" data-path="adapter-array.html"><a href="adapter-array.html#part-2-9"><i class="fa fa-check"></i><b>10.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="seating-system.html"><a href="seating-system.html"><i class="fa fa-check"></i><b>11</b> Seating System</a><ul>
<li class="chapter" data-level="11.1" data-path="seating-system.html"><a href="seating-system.html#part-1-10"><i class="fa fa-check"></i><b>11.1</b> Part 1</a></li>
<li class="chapter" data-level="11.2" data-path="seating-system.html"><a href="seating-system.html#part-2-10"><i class="fa fa-check"></i><b>11.2</b> Part 2</a></li>
<li class="chapter" data-level="11.3" data-path="seating-system.html"><a href="seating-system.html#solving-faster"><i class="fa fa-check"></i><b>11.3</b> Solving faster</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="rain-risk.html"><a href="rain-risk.html"><i class="fa fa-check"></i><b>12</b> Rain Risk</a><ul>
<li class="chapter" data-level="12.1" data-path="rain-risk.html"><a href="rain-risk.html#part-1-11"><i class="fa fa-check"></i><b>12.1</b> Part 1</a></li>
<li class="chapter" data-level="12.2" data-path="rain-risk.html"><a href="rain-risk.html#part-2-11"><i class="fa fa-check"></i><b>12.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="shuttle-search.html"><a href="shuttle-search.html"><i class="fa fa-check"></i><b>13</b> Shuttle Search</a><ul>
<li class="chapter" data-level="13.1" data-path="shuttle-search.html"><a href="shuttle-search.html#part-1-12"><i class="fa fa-check"></i><b>13.1</b> Part 1</a></li>
<li class="chapter" data-level="13.2" data-path="shuttle-search.html"><a href="shuttle-search.html#part-2-12"><i class="fa fa-check"></i><b>13.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="docking-data.html"><a href="docking-data.html"><i class="fa fa-check"></i><b>14</b> Docking Data</a><ul>
<li class="chapter" data-level="14.1" data-path="docking-data.html"><a href="docking-data.html#part-1-13"><i class="fa fa-check"></i><b>14.1</b> Part 1</a></li>
<li class="chapter" data-level="14.2" data-path="docking-data.html"><a href="docking-data.html#part-2-13"><i class="fa fa-check"></i><b>14.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="rambunctious-recitation.html"><a href="rambunctious-recitation.html"><i class="fa fa-check"></i><b>15</b> Rambunctious Recitation</a><ul>
<li class="chapter" data-level="15.1" data-path="rambunctious-recitation.html"><a href="rambunctious-recitation.html#part-1-14"><i class="fa fa-check"></i><b>15.1</b> Part 1</a></li>
<li class="chapter" data-level="15.2" data-path="rambunctious-recitation.html"><a href="rambunctious-recitation.html#part-2-14"><i class="fa fa-check"></i><b>15.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="ticket-translation.html"><a href="ticket-translation.html"><i class="fa fa-check"></i><b>16</b> Ticket Translation</a><ul>
<li class="chapter" data-level="16.1" data-path="ticket-translation.html"><a href="ticket-translation.html#part-1-15"><i class="fa fa-check"></i><b>16.1</b> Part 1</a></li>
<li class="chapter" data-level="16.2" data-path="ticket-translation.html"><a href="ticket-translation.html#part-2-15"><i class="fa fa-check"></i><b>16.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="conway-cubes.html"><a href="conway-cubes.html"><i class="fa fa-check"></i><b>17</b> Conway Cubes</a><ul>
<li class="chapter" data-level="17.1" data-path="conway-cubes.html"><a href="conway-cubes.html#part-1-16"><i class="fa fa-check"></i><b>17.1</b> Part 1</a></li>
<li class="chapter" data-level="17.2" data-path="conway-cubes.html"><a href="conway-cubes.html#part-2-16"><i class="fa fa-check"></i><b>17.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="operation-order.html"><a href="operation-order.html"><i class="fa fa-check"></i><b>18</b> Operation Order</a><ul>
<li class="chapter" data-level="18.1" data-path="operation-order.html"><a href="operation-order.html#part-1-17"><i class="fa fa-check"></i><b>18.1</b> Part 1</a></li>
<li class="chapter" data-level="18.2" data-path="operation-order.html"><a href="operation-order.html#part-2-17"><i class="fa fa-check"></i><b>18.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="monster-messages.html"><a href="monster-messages.html"><i class="fa fa-check"></i><b>19</b> Monster Messages</a><ul>
<li class="chapter" data-level="19.1" data-path="monster-messages.html"><a href="monster-messages.html#part-1-18"><i class="fa fa-check"></i><b>19.1</b> Part 1</a></li>
<li class="chapter" data-level="19.2" data-path="monster-messages.html"><a href="monster-messages.html#part-2-18"><i class="fa fa-check"></i><b>19.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="jurassic-jigsaw.html"><a href="jurassic-jigsaw.html"><i class="fa fa-check"></i><b>20</b> Jurassic Jigsaw</a><ul>
<li class="chapter" data-level="20.1" data-path="jurassic-jigsaw.html"><a href="jurassic-jigsaw.html#part-1-19"><i class="fa fa-check"></i><b>20.1</b> Part 1</a></li>
<li class="chapter" data-level="20.2" data-path="jurassic-jigsaw.html"><a href="jurassic-jigsaw.html#part-2-19"><i class="fa fa-check"></i><b>20.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="allergen-assessment.html"><a href="allergen-assessment.html"><i class="fa fa-check"></i><b>21</b> Allergen Assessment</a><ul>
<li class="chapter" data-level="21.1" data-path="allergen-assessment.html"><a href="allergen-assessment.html#part-1-20"><i class="fa fa-check"></i><b>21.1</b> Part 1</a></li>
<li class="chapter" data-level="21.2" data-path="allergen-assessment.html"><a href="allergen-assessment.html#part-2-20"><i class="fa fa-check"></i><b>21.2</b> Part 2</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advent of Code 2020</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="docking-data" class="section level1">
<h1><span class="header-section-number">Day 14</span> Docking Data</h1>
<p>This is my attempt to solve <a href="https://adventofcode.com/2020/day/14">Day 14</a>.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="docking-data.html#cb242-1"></a>sample &lt;-<span class="st"> </span><span class="kw">read_lines</span>(<span class="st">&quot;samples/day_14_sample.txt&quot;</span>)</span>
<span id="cb242-2"><a href="docking-data.html#cb242-2"></a>actual &lt;-<span class="st"> </span><span class="kw">read_lines</span>(<span class="st">&quot;inputs/day_14_input.txt&quot;</span>)</span></code></pre></div>
<div id="part-1-13" class="section level2">
<h2><span class="header-section-number">14.1</span> Part 1</h2>
<p>Part 1 requires us to apply a “bitmask” to a number. The function <code>packBits()</code> can convert a vector of <code>raw</code> values
back to an integer, but there are 2 issues.</p>
<p>First, integers in R are signed 32-bit values, and our mask is 36-bits long. We need to handle the sign bit separately,
otherwise we may end up with negative numbers.</p>
<p>Secondly, <code>packBits()</code> is big <a href="https://en.wikipedia.org/wiki/Endianness">endian</a>, but the mask is little endian. So we
need to reverse the values in the mask.</p>
<p>We can solve today’s problem by taking two copies of the mask. <code>mask0</code> will be where we apply the replace 0 logic. We
can achieve this with a bitwise and, and a mask of all 1’s except where the mask is a 0. <code>mask1</code> will be where we apply
the replace 1 logic. We can achieve this with a bitwise or, and a mask of all 0’s except where the mask is a 1.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="docking-data.html#cb243-1"></a>part_<span class="dv">1</span>_apply_mask &lt;-<span class="st"> </span><span class="cf">function</span>(value, mask) {</span>
<span id="cb243-2"><a href="docking-data.html#cb243-2"></a>  mask &lt;-<span class="st"> </span><span class="kw">str_extract_all</span>(mask, <span class="st">&quot;.&quot;</span>)[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rev</span>()</span>
<span id="cb243-3"><a href="docking-data.html#cb243-3"></a></span>
<span id="cb243-4"><a href="docking-data.html#cb243-4"></a>  mask0 &lt;-<span class="st"> </span><span class="kw">str_replace</span>(mask, <span class="st">&quot;X&quot;</span>, <span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.raw</span>()</span>
<span id="cb243-5"><a href="docking-data.html#cb243-5"></a>  mask1 &lt;-<span class="st"> </span><span class="kw">str_replace</span>(mask, <span class="st">&quot;X&quot;</span>, <span class="st">&quot;0&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.raw</span>()</span>
<span id="cb243-6"><a href="docking-data.html#cb243-6"></a>  </span>
<span id="cb243-7"><a href="docking-data.html#cb243-7"></a>  <span class="co"># ignore the most significant bit... assume all our numbers are positive...</span></span>
<span id="cb243-8"><a href="docking-data.html#cb243-8"></a>  mask0_lsb &lt;-<span class="st"> </span><span class="kw">packBits</span>(<span class="kw">c</span>(mask0[<span class="dv">1</span><span class="op">:</span><span class="dv">31</span>], <span class="kw">raw</span>(<span class="dv">1</span>)), <span class="st">&quot;integer&quot;</span>)</span>
<span id="cb243-9"><a href="docking-data.html#cb243-9"></a>  mask1_lsb &lt;-<span class="st"> </span><span class="kw">packBits</span>(<span class="kw">c</span>(mask1[<span class="dv">1</span><span class="op">:</span><span class="dv">31</span>], <span class="kw">raw</span>(<span class="dv">1</span>)), <span class="st">&quot;integer&quot;</span>)</span>
<span id="cb243-10"><a href="docking-data.html#cb243-10"></a>  </span>
<span id="cb243-11"><a href="docking-data.html#cb243-11"></a>  mask1_msb &lt;-<span class="st"> </span><span class="kw">packBits</span>(<span class="kw">c</span>(mask1[<span class="dv">32</span><span class="op">:</span><span class="dv">36</span>], <span class="kw">raw</span>(<span class="dv">27</span>)), <span class="st">&quot;integer&quot;</span>)</span>
<span id="cb243-12"><a href="docking-data.html#cb243-12"></a>  </span>
<span id="cb243-13"><a href="docking-data.html#cb243-13"></a>  v &lt;-<span class="st"> </span>value <span class="op">%&gt;%</span></span>
<span id="cb243-14"><a href="docking-data.html#cb243-14"></a><span class="st">    </span><span class="kw">bitwAnd</span>(mask0_lsb) <span class="op">%&gt;%</span></span>
<span id="cb243-15"><a href="docking-data.html#cb243-15"></a><span class="st">    </span><span class="kw">bitwOr</span>(mask1_lsb)</span>
<span id="cb243-16"><a href="docking-data.html#cb243-16"></a>  </span>
<span id="cb243-17"><a href="docking-data.html#cb243-17"></a>  <span class="kw">as.numeric</span>(v) <span class="op">+</span><span class="st"> </span><span class="kw">as.numeric</span>(mask1_msb) <span class="op">*</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">**</span><span class="st"> </span><span class="dv">31</span>)</span>
<span id="cb243-18"><a href="docking-data.html#cb243-18"></a>}</span></code></pre></div>
<p>We can now solve part 1 by building a data frame that has a column for the mask along with the value. Note that if a
memory location is updated twice we only keep the last value, so we can group by the memory locations and just keep
the last value.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="docking-data.html#cb244-1"></a>part_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="cf">function</span>(input) {</span>
<span id="cb244-2"><a href="docking-data.html#cb244-2"></a>  input <span class="op">%&gt;%</span></span>
<span id="cb244-3"><a href="docking-data.html#cb244-3"></a><span class="st">    </span><span class="kw">unglue_data</span>(<span class="st">&quot;{instruction} = {value}&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb244-4"><a href="docking-data.html#cb244-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">mask =</span> <span class="kw">ifelse</span>(instruction <span class="op">==</span><span class="st"> &quot;mask&quot;</span>, value, <span class="ot">NA</span>)) <span class="op">%&gt;%</span></span>
<span id="cb244-5"><a href="docking-data.html#cb244-5"></a><span class="st">    </span><span class="kw">fill</span>(mask) <span class="op">%&gt;%</span></span>
<span id="cb244-6"><a href="docking-data.html#cb244-6"></a><span class="st">    </span><span class="kw">filter</span>(instruction <span class="op">!=</span><span class="st"> &quot;mask&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb244-7"><a href="docking-data.html#cb244-7"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="kw">across</span>(instruction, str_extract, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d+&quot;</span>),</span>
<span id="cb244-8"><a href="docking-data.html#cb244-8"></a>           <span class="kw">across</span>(<span class="kw">c</span>(instruction, value), as.integer)) <span class="op">%&gt;%</span></span>
<span id="cb244-9"><a href="docking-data.html#cb244-9"></a><span class="st">    </span><span class="kw">group_by</span>(instruction) <span class="op">%&gt;%</span></span>
<span id="cb244-10"><a href="docking-data.html#cb244-10"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="kw">across</span>(<span class="kw">everything</span>(), last), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb244-11"><a href="docking-data.html#cb244-11"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">new_val =</span> <span class="kw">map2_dbl</span>(value, mask, part_<span class="dv">1</span>_apply_mask)) <span class="op">%&gt;%</span></span>
<span id="cb244-12"><a href="docking-data.html#cb244-12"></a><span class="st">    </span><span class="kw">pull</span>(new_val) <span class="op">%&gt;%</span></span>
<span id="cb244-13"><a href="docking-data.html#cb244-13"></a><span class="st">    </span><span class="kw">sum</span>()</span>
<span id="cb244-14"><a href="docking-data.html#cb244-14"></a>}</span></code></pre></div>
<p>We can now test our function with the sample data:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="docking-data.html#cb245-1"></a><span class="kw">part_1</span>(sample) <span class="op">==</span><span class="st"> </span><span class="dv">165</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>And we can run with the actual data:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="docking-data.html#cb247-1"></a><span class="kw">part_1</span>(actual)</span></code></pre></div>
<pre><code>## [1] 15514035145260</code></pre>
</div>
<div id="part-2-13" class="section level2">
<h2><span class="header-section-number">14.2</span> Part 2</h2>
<p>In part 2 we have a more complex scenario. We create a new “apply mask” function that will apply these rules. This
function will take the current memory, apply the rules for the current row of data, then return the memory. This can be
used in within <code>reduce()</code> to iterate over the data and update the memory.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="docking-data.html#cb249-1"></a>part_<span class="dv">2</span>_apply_mask &lt;-<span class="st"> </span><span class="cf">function</span>(memory, mem_loc, value, mask) {</span>
<span id="cb249-2"><a href="docking-data.html#cb249-2"></a>  m &lt;-<span class="st"> </span><span class="kw">str_extract_all</span>(mask, <span class="st">&quot;.&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb249-3"><a href="docking-data.html#cb249-3"></a>  </span>
<span id="cb249-4"><a href="docking-data.html#cb249-4"></a>  <span class="co"># convert mem_loc to a binary number</span></span>
<span id="cb249-5"><a href="docking-data.html#cb249-5"></a>  mem_loc_b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">raw</span>(<span class="dv">4</span>), <span class="kw">rev</span>(<span class="kw">intToBits</span>(mem_loc)))</span>
<span id="cb249-6"><a href="docking-data.html#cb249-6"></a>  </span>
<span id="cb249-7"><a href="docking-data.html#cb249-7"></a>  all_mem_locs &lt;-<span class="st"> </span><span class="kw">list</span>(mem_loc_b)</span>
<span id="cb249-8"><a href="docking-data.html#cb249-8"></a>  </span>
<span id="cb249-9"><a href="docking-data.html#cb249-9"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">36</span>) {</span>
<span id="cb249-10"><a href="docking-data.html#cb249-10"></a>    <span class="cf">if</span> (m[[i]] <span class="op">==</span><span class="st"> &quot;1&quot;</span>) {</span>
<span id="cb249-11"><a href="docking-data.html#cb249-11"></a>      <span class="cf">for</span> (j <span class="cf">in</span> <span class="kw">seq_along</span>(all_mem_locs)) {</span>
<span id="cb249-12"><a href="docking-data.html#cb249-12"></a>        all_mem_locs[[j]][[i]] &lt;-<span class="st"> </span><span class="kw">as.raw</span>(<span class="dv">1</span>)</span>
<span id="cb249-13"><a href="docking-data.html#cb249-13"></a>      }</span>
<span id="cb249-14"><a href="docking-data.html#cb249-14"></a>    } <span class="cf">else</span> <span class="cf">if</span> (m[[i]] <span class="op">==</span><span class="st"> &quot;X&quot;</span>) {</span>
<span id="cb249-15"><a href="docking-data.html#cb249-15"></a>      a &lt;-<span class="st"> </span>all_mem_locs</span>
<span id="cb249-16"><a href="docking-data.html#cb249-16"></a>      b &lt;-<span class="st"> </span>all_mem_locs</span>
<span id="cb249-17"><a href="docking-data.html#cb249-17"></a>      </span>
<span id="cb249-18"><a href="docking-data.html#cb249-18"></a>      <span class="cf">for</span> (j <span class="cf">in</span> <span class="kw">seq_along</span>(all_mem_locs)) {</span>
<span id="cb249-19"><a href="docking-data.html#cb249-19"></a>        a[[j]][[i]] &lt;-<span class="st"> </span><span class="kw">as.raw</span>(<span class="dv">0</span>)</span>
<span id="cb249-20"><a href="docking-data.html#cb249-20"></a>        b[[j]][[i]] &lt;-<span class="st"> </span><span class="kw">as.raw</span>(<span class="dv">1</span>)</span>
<span id="cb249-21"><a href="docking-data.html#cb249-21"></a>      }</span>
<span id="cb249-22"><a href="docking-data.html#cb249-22"></a>      </span>
<span id="cb249-23"><a href="docking-data.html#cb249-23"></a>      all_mem_locs &lt;-<span class="st"> </span><span class="kw">c</span>(a, b)</span>
<span id="cb249-24"><a href="docking-data.html#cb249-24"></a>    }</span>
<span id="cb249-25"><a href="docking-data.html#cb249-25"></a>  }</span>
<span id="cb249-26"><a href="docking-data.html#cb249-26"></a>  </span>
<span id="cb249-27"><a href="docking-data.html#cb249-27"></a>  <span class="cf">for</span> (ml <span class="cf">in</span> all_mem_locs) {</span>
<span id="cb249-28"><a href="docking-data.html#cb249-28"></a>    mls &lt;-<span class="st"> </span><span class="kw">paste</span>(ml, <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb249-29"><a href="docking-data.html#cb249-29"></a>    memory[[mls]] &lt;-<span class="st"> </span>value</span>
<span id="cb249-30"><a href="docking-data.html#cb249-30"></a>  }</span>
<span id="cb249-31"><a href="docking-data.html#cb249-31"></a>  </span>
<span id="cb249-32"><a href="docking-data.html#cb249-32"></a>  memory</span>
<span id="cb249-33"><a href="docking-data.html#cb249-33"></a>}</span></code></pre></div>
<p>Part 2 provides a new sample</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="docking-data.html#cb250-1"></a>sample_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;mask = 000000000000000000000000000000X1001X&quot;</span>,</span>
<span id="cb250-2"><a href="docking-data.html#cb250-2"></a>              <span class="st">&quot;mem[42] = 100&quot;</span>,</span>
<span id="cb250-3"><a href="docking-data.html#cb250-3"></a>              <span class="st">&quot;mask = 00000000000000000000000000000000X0XX&quot;</span>,</span>
<span id="cb250-4"><a href="docking-data.html#cb250-4"></a>              <span class="st">&quot;mem[26] = 1&quot;</span>)</span></code></pre></div>
<p>We build a function now for solving part 2. We start by reusing the data processing step from part 1. We can then use
a little helper function to run the <code>part_2_apply_mask()</code> function, and put it all together with a <code>reduce()</code> over the
data.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="docking-data.html#cb251-1"></a>part_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="cf">function</span>(input) {</span>
<span id="cb251-2"><a href="docking-data.html#cb251-2"></a>  data &lt;-<span class="st"> </span>input <span class="op">%&gt;%</span></span>
<span id="cb251-3"><a href="docking-data.html#cb251-3"></a><span class="st">    </span><span class="kw">unglue_data</span>(<span class="st">&quot;{instruction} = {value}&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb251-4"><a href="docking-data.html#cb251-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">mask =</span> <span class="kw">ifelse</span>(instruction <span class="op">==</span><span class="st"> &quot;mask&quot;</span>, value, <span class="ot">NA</span>)) <span class="op">%&gt;%</span></span>
<span id="cb251-5"><a href="docking-data.html#cb251-5"></a><span class="st">    </span><span class="kw">fill</span>(mask) <span class="op">%&gt;%</span></span>
<span id="cb251-6"><a href="docking-data.html#cb251-6"></a><span class="st">    </span><span class="kw">filter</span>(instruction <span class="op">!=</span><span class="st"> &quot;mask&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb251-7"><a href="docking-data.html#cb251-7"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="kw">across</span>(instruction, str_extract, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d+&quot;</span>),</span>
<span id="cb251-8"><a href="docking-data.html#cb251-8"></a>           <span class="kw">across</span>(<span class="kw">c</span>(instruction, value), as.integer)) <span class="op">%&gt;%</span></span>
<span id="cb251-9"><a href="docking-data.html#cb251-9"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">mem_loc =</span> instruction)</span>
<span id="cb251-10"><a href="docking-data.html#cb251-10"></a>  </span>
<span id="cb251-11"><a href="docking-data.html#cb251-11"></a>  part_<span class="dv">2</span>_fn &lt;-<span class="st"> </span><span class="cf">function</span>(memory, data_row) {</span>
<span id="cb251-12"><a href="docking-data.html#cb251-12"></a>    <span class="kw">with</span>(data_row, {</span>
<span id="cb251-13"><a href="docking-data.html#cb251-13"></a>      <span class="kw">part_2_apply_mask</span>(memory, mem_loc, value, mask)</span>
<span id="cb251-14"><a href="docking-data.html#cb251-14"></a>    })</span>
<span id="cb251-15"><a href="docking-data.html#cb251-15"></a>  }</span>
<span id="cb251-16"><a href="docking-data.html#cb251-16"></a>  </span>
<span id="cb251-17"><a href="docking-data.html#cb251-17"></a>  data <span class="op">%&gt;%</span></span>
<span id="cb251-18"><a href="docking-data.html#cb251-18"></a><span class="st">    </span><span class="kw">transpose</span>() <span class="op">%&gt;%</span></span>
<span id="cb251-19"><a href="docking-data.html#cb251-19"></a><span class="st">    </span><span class="kw">reduce</span>(part_<span class="dv">2</span>_fn, <span class="dt">.init =</span> <span class="kw">list</span>()) <span class="op">%&gt;%</span></span>
<span id="cb251-20"><a href="docking-data.html#cb251-20"></a><span class="st">    </span><span class="kw">flatten_dbl</span>() <span class="op">%&gt;%</span></span>
<span id="cb251-21"><a href="docking-data.html#cb251-21"></a><span class="st">    </span><span class="kw">sum</span>()</span>
<span id="cb251-22"><a href="docking-data.html#cb251-22"></a>}</span></code></pre></div>
<p>We can now run our function on the new sample data</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="docking-data.html#cb252-1"></a><span class="kw">part_2</span>(sample_<span class="dv">2</span>) <span class="op">==</span><span class="st"> </span><span class="dv">208</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="docking-data.html#cb254-1"></a><span class="kw">part_2</span>(actual)</span></code></pre></div>
<pre><code>## [1] 3926790061594</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="shuttle-search.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rambunctious-recitation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
